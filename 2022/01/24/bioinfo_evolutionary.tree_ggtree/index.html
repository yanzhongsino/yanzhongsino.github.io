<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="记录进化树的绘制，软件的使用，详细介绍了几种树文件的格式，ggtree绘制树和注释树。">
<meta property="og:type" content="article">
<meta property="og:title" content="绘制进化树 —— R包treeio+ggtree">
<meta property="og:url" content="http://example.com/2022/01/24/bioinfo_evolutionary.tree_ggtree/index.html">
<meta property="og:site_name" content="生信技工">
<meta property="og:description" content="记录进化树的绘制，软件的使用，详细介绍了几种树文件的格式，ggtree绘制树和注释树。">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://guangchuangyu.github.io/blog_images/Bioconductor/ggtree/facet_plot_dot2.png">
<meta property="og:image" content="https://guangchuangyu.github.io/blog_images/Bioconductor/ggtree/facet_plot_bar2.png">
<meta property="og:image" content="https://guangchuangyu.github.io/blog_images/Bioconductor/ggtree/facet_plot_boxplot2.png">
<meta property="og:image" content="https://github.com/yanzhongsino/yanzhongsino.github.io/blob/hexo/source/wechat/Wechat_public_qrcode.jpg?raw=true">
<meta property="article:published_time" content="2022-01-24T13:00:00.000Z">
<meta property="article:modified_time" content="2022-10-11T09:44:12.394Z">
<meta property="article:author" content="南方枝叶">
<meta property="article:tag" content="tutorial">
<meta property="article:tag" content="biosoft">
<meta property="article:tag" content="phylogeny">
<meta property="article:tag" content="evolutionary tree">
<meta property="article:tag" content="R">
<meta property="article:tag" content="itol">
<meta property="article:tag" content="treeio">
<meta property="article:tag" content="ggtree">
<meta property="article:tag" content="facet_plot">
<meta property="article:tag" content="ggstance">
<meta property="article:tag" content="phylogenetic reticulum">
<meta property="article:tag" content="geom_taxalink">
<meta property="article:tag" content="multiPhylo">
<meta property="article:tag" content="ggdensitree">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://guangchuangyu.github.io/blog_images/Bioconductor/ggtree/facet_plot_dot2.png">

<link rel="canonical" href="http://example.com/2022/01/24/bioinfo_evolutionary.tree_ggtree/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>绘制进化树 —— R包treeio+ggtree | 生信技工</title>
  


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?a7db9ab8b9b3ef3b239a82e4a58e43dc";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --></head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">生信技工</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-resume">

    <a href="/resume/index.html" rel="section"><i class="fa fa-file fa-fw"></i>resume</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/01/24/bioinfo_evolutionary.tree_ggtree/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="南方枝叶">
      <meta itemprop="description" content="学习生物信息学的笔记本">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="生信技工">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          绘制进化树 —— R包treeio+ggtree
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-01-24 21:00:00" itemprop="dateCreated datePublished" datetime="2022-01-24T21:00:00+08:00">2022-01-24</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-10-11 17:44:12" itemprop="dateModified" datetime="2022-10-11T17:44:12+08:00">2022-10-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/bio/" itemprop="url" rel="index"><span itemprop="name">bio</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/bio/bioinfo/" itemprop="url" rel="index"><span itemprop="name">bioinfo</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="Views" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2022/01/24/bioinfo_evolutionary.tree_ggtree/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2022/01/24/bioinfo_evolutionary.tree_ggtree/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
              <span>16k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
              <span>15 mins.</span>
            </span>
            <div class="post-description">记录进化树的绘制，软件的使用，详细介绍了几种树文件的格式，ggtree绘制树和注释树。</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <div align="middle"><iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=298 height=52 src="//music.163.com/outchain/player?type=2&id=283100&auto=1&height=32"></iframe></div>

<h1 id="1-进化树"><a href="#1-进化树" class="headerlink" title="1. 进化树"></a>1. 进化树</h1><p>进化树的相关知识可以参考<a target="_blank" rel="noopener" href="https://yanzhongsino.github.io/2021/11/20/bio_evolutionary.tree/">博文进化树相关知识</a>。</p>
<h1 id="2-进化树的绘制"><a href="#2-进化树的绘制" class="headerlink" title="2. 进化树的绘制"></a>2. 进化树的绘制</h1><p>进化树的绘制是指把newick格式的树文件转换成树图形，有许多软件可以使用，在线网页版（itol，EvolView），也有R包（ggtree），或者软件figtree。<br>如果是简单的树绘制，推荐在线网页<strong>itol</strong>；如果需要精细的注释，推荐R包<strong>ggtree</strong>。</p>
<h2 id="2-1-在线绘制进化树"><a href="#2-1-在线绘制进化树" class="headerlink" title="2.1. 在线绘制进化树"></a>2.1. 在线绘制进化树</h2><ol>
<li><a target="_blank" rel="noopener" href="https://itol.embl.de/">itol</a></li>
<li><a target="_blank" rel="noopener" href="https://www.evolgenius.info/evolview/#login">EvolView</a></li>
</ol>
<h2 id="2-2-R包ggtree【推荐】"><a href="#2-2-R包ggtree【推荐】" class="headerlink" title="2.2. R包ggtree【推荐】"></a>2.2. R包ggtree【推荐】</h2><p>R包treeio用于解析各种格式的进化树文件，ggtree用于绘制进化树和注释。</p>
<h3 id="2-2-1-树文件的导入"><a href="#2-2-1-树文件的导入" class="headerlink" title="2.2.1. 树文件的导入"></a>2.2.1. 树文件的导入</h3><h4 id="2-2-1-1-treeio导入树"><a href="#2-2-1-1-treeio导入树" class="headerlink" title="2.2.1.1. treeio导入树"></a>2.2.1.1. treeio导入树</h4><p>treeio支持标准格式树（包括Newick树格式，NEXUS树格式，New Hampshire eXtended(NHX)树格式，Jplace树格式）和建树软件输出树（RAxML，iqtree，BEAST，MrBayes，PAML(BASEML,CODEML)，r8s，MEGA，HyPhy，Phylip，以及生成Jplace格式树的EPA和PPLACER），可以用文本输入和文件输入两种形式导入和解析树。</p>
<p><a target="_blank" rel="noopener" href="https://guangchuangyu.github.io/ggtree-book/chapter-treeio.html">treeio tutorial</a>解释了各种建树软件输出的树包含的信息。</p>
<ol>
<li>文本输入<br>当树文件的文本比较简单时，可以直接把文本读到变量中，再解析。</li>
</ol>
<ul>
<li><p>Newick格式树<br><code>read.newick()</code>：用read.newick读取Newick格式的树文本，有枝长信息，缺点是没有办法添加注释信息</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">library<span class="punctuation">(</span>treeio<span class="punctuation">)</span></span><br><span class="line">treetext<span class="operator">&lt;-</span><span class="string">&quot;((((Mc:0.418672,Eg:0.201388):0.148853,((Pt:0.219587,(Cs:0.209405,(Gr:0.224188,At:0.492461):0.027774):0.012564):0.019343,(Pp:0.194515,(Mt:0.354580,Cl:0.338644:0.022063):0.019111):0.011710):0.029914,Vv:0.169100):0.241611,Mg:0.241611);&quot;</span>  </span><br><span class="line">tree <span class="operator">&lt;-</span> read.newick<span class="punctuation">(</span>textConnection<span class="punctuation">(</span>treetext<span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>NHX格式树<br><code>read.nhx()</code>：用read.nhx()读取NHX格式的树文本，节点后中括号内[&amp;&amp;NHX]添加值注释信息，用冒号:分隔多个注释信息，缺点是没有办法添加范围注释，比如95%置信区间注释</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">treetext<span class="operator">&lt;</span><span class="string">&quot;((((Mc:0.418672[&amp;&amp;NHX:I=5728:D=1170:G=Malvids],Eg:0.201388[&amp;&amp;NHX:I=1420:D=2519:G=Malvids])[&amp;&amp;NHX:C=1]:0.148853,((Pt:0.219587[&amp;&amp;NHX:I=5355:D=1003:G=Fabids],(Cs:0.209405[&amp;&amp;NHX:I=1026:D=3516:G=Malvids],(Gr:0.224188[&amp;&amp;NHX:I=4875:D=998:G=Malvids],At:0.492461[&amp;&amp;NHX:I=1776:D=2891:G=Malvids]):0.027774[&amp;&amp;NHX:C=2]):0.012564[&amp;&amp;NHX:C=3]):0.019343[&amp;&amp;NHX:C=4],(Pp:0.194515[&amp;&amp;NHX:I=1159:D=2949:G=Fabids],(Mt:0.354580[&amp;&amp;NHX:I=3310:D=1984:G=Fabids],Cl:0.338644[&amp;&amp;NHX:I=794:D=3735:G=Fabids]):0.022063[&amp;&amp;NHX:C=5]):0.019111[&amp;&amp;NHX:C=6]):0.011710[&amp;&amp;NHX:C=7]):0.029914[&amp;&amp;NHX:C=8],Vv:0.169100[&amp;&amp;NHX:I=1522:D=3045:G=Vitales]):0.241611[&amp;&amp;NHX:C=9],Mg:0.241611[&amp;&amp;NHX:I=2278:D=1909:G=Asterids])[&amp;&amp;NHX:C=10];&quot;</span>  </span><br><span class="line">tree <span class="operator">&lt;-</span> read.nhx<span class="punctuation">(</span>textConnection<span class="punctuation">(</span>treetext<span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure></li>
</ul>
<ol start="2">
<li>treeio导入树文件<br>treeio支持解析大部分软件输出的树文件</li>
</ol>
<table>
<thead>
<tr>
<th>解析函数Parser function</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>read.newick</td>
<td>解析Newick格式文件</td>
</tr>
<tr>
<td>read.nexus</td>
<td>解析NEXUS格式文件</td>
</tr>
<tr>
<td>read.nhx</td>
<td>解析NHX格式文件</td>
</tr>
<tr>
<td>read.jplace</td>
<td>解析jplace格式文件，包括EPA和pplacer的输出文件</td>
</tr>
<tr>
<td>read.jtree</td>
<td>解析jtree格式文件</td>
</tr>
<tr>
<td>read.fasta</td>
<td>解析fasta序列</td>
</tr>
<tr>
<td>read.iqtree</td>
<td>解析IQ-Tree的Newick格式输出，支持解析SH-aLRT和UFBoot支持率</td>
</tr>
<tr>
<td>read.raxml</td>
<td>解析RAxML的输出</td>
</tr>
<tr>
<td>read.r8s</td>
<td>解析r8s的输出</td>
</tr>
<tr>
<td>read.mrbayes</td>
<td>解析MrBayes的输出</td>
</tr>
<tr>
<td>read.beast</td>
<td>解析BEAST的输出</td>
</tr>
<tr>
<td>read.astral</td>
<td>解析ASTRAL的输出</td>
</tr>
<tr>
<td>read.mega</td>
<td>解析MEGA的Nexus格式输出</td>
</tr>
<tr>
<td>read.codeml</td>
<td>解析CodeML的输出，rst和mlc文件</td>
</tr>
<tr>
<td>read.paml_rst</td>
<td>解析rst文件，BaseML或CodeML的输出</td>
</tr>
<tr>
<td>read.hyphy</td>
<td>解析HyPhy输出文件</td>
</tr>
<tr>
<td>…</td>
<td>…</td>
</tr>
</tbody></table>
<p>用对应的解析函数读取相应格式的文件，例如读取Newick格式文件用<code>tree&lt;-read.newick(&quot;newick.tre&quot;)</code>,读取beast输出的树文件用<code>tree&lt;-read.beast(&quot;beast.tre&quot;)</code>。</p>
<ol start="3">
<li>read.mega&#x2F;read.beast读取NEXUS格式文件</li>
</ol>
<ul>
<li>NEXUS格式把Newick树和其他信息组合，每种信息单独成块(blocks)，可扩展块来实现添加新类别的信息，NEXUS格式可以看作Newick树加注释信息的组合。</li>
<li>NEXUS格式树包括TAXA块和TREE块，常常也会包括储存序列比对(Phylip格式)的DATA块，有些软件有自己特定的块。</li>
<li>每个块都是<code>Begin Blockname;</code>开头，<code>End;</code>加一个空行结尾。</li>
<li>NEXUS格式的优点是可以实现尽可能地注释树，包括值注释和区间注释(例如95%置信区间)，缺点是格式稍微复杂，必须文件读取。</li>
<li>我自己尝试用read.nexus读取NEXUS文件，读取没问题，但如果想使用注释信息(比如geom_text&#x2F;geom_label2使用注释，geom_range来显示区间注释)就会报错；但是用read.mega&#x2F;read.beast读取NEXUS文件就可以顺利使用注释信息，查看了treeio里的示例文件，read.mega和read.beast里的NEXUS文件格式是一样的，区别在于beast只能读NEXUS文件，mega还可以都Newick文件。</li>
</ul>
<p>一个NEXUS文件的例子，treeio包自带的mtCDNA_timetree.nex文件，可以参考示例文件格式自己写一个NEXUS格式的树文件用于ggtree：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">#NEXUS</span><br><span class="line"></span><br><span class="line">Begin Taxa;</span><br><span class="line">	Dimensions ntax=7;</span><br><span class="line">	TaxLabels</span><br><span class="line">		homo_sapiens</span><br><span class="line">		chimpanzee</span><br><span class="line">		bonobo</span><br><span class="line">		gorilla</span><br><span class="line">		orangutan</span><br><span class="line">		sumatran</span><br><span class="line">		gibbon</span><br><span class="line">		;</span><br><span class="line">End;</span><br><span class="line"></span><br><span class="line">Begin Trees;</span><br><span class="line">	Translate</span><br><span class="line">		1 homo_sapiens,</span><br><span class="line">		2 chimpanzee,</span><br><span class="line">		3 bonobo,</span><br><span class="line">		4 gorilla,</span><br><span class="line">		5 orangutan,</span><br><span class="line">		6 sumatran,</span><br><span class="line">		7 gibbon</span><br><span class="line">		;</span><br><span class="line">tree TREE1 = [&amp;R] (((((2[&amp;rate=8.21387638458966E-001,branch_length=6.27635980985610E-002]:7.76603755686346E-002,3[&amp;rate=8.08047027678532E-001,branch_length=6.17442197999256E-002]:7.76603755686346E-002)[&amp;rate=8.14690026837604E-001,branch_length=1.06551791913040E-001,reltime=7.76603755686346E-002,reltime_stderr=1.66322225004909E-002,reltime_95%_CI=&#123;4.50612194676725E-002,1.10259531669597E-001&#125;,data_coverage=100%]:1.32925460715114E-001,1[&amp;rate=1.14839817218159E+000,branch_length=2.37947876847083E-001]:2.10585836283749E-001)[&amp;rate=9.67258258023612E-001,branch_length=6.82392048602499E-002,reltime=2.10585836283749E-001,reltime_stderr=3.66695942566917E-002,reltime_95%_CI=&#123;1.38713431540633E-001,2.82458241026865E-001&#125;,data_coverage=100%]:7.17020095880709E-002,4[&amp;rate=9.49741644253964E-001,branch_length=2.63789706511460E-001]:2.82287845871820E-001)[&amp;rate=9.58459935726878E-001,branch_length=2.94031112947650E-001,reltime=2.82287845871820E-001,reltime_stderr=4.16686354669857E-002,reltime_95%_CI=&#123;2.00617320356528E-001,3.63958371387112E-001&#125;,data_coverage=100%]:3.11787816307430E-001,(5[&amp;rate=1.34822289815278E+000,branch_length=1.52886612438902E-001]:1.15251762438322E-001,6[&amp;rate=8.34007596053647E-001,branch_length=9.45753081954446E-002]:1.15251762438322E-001)[&amp;rate=1.06039055929072E+000,branch_length=4.99576332711077E-001,reltime=1.15251762438322E-001,reltime_stderr=1.98603068330366E-002,reltime_95%_CI=&#123;7.63255610455702E-002,1.54177963831074E-001&#125;,data_coverage=100%]:4.78823899740928E-001)[&amp;rate=1.00813782158154E+000,branch_length=2.10619528131437E-001,reltime=5.94075662179250E-001,reltime_stderr=7.90987567922010E-002,reltime_95%_CI=&#123;4.39042098866536E-001,7.49109225491964E-001&#125;,data_coverage=100%]:2.12333512272958E-001,7[&amp;rate=1.00813782158154E+000,branch_length=7.99899733140789E-001]:8.06409174452208E-001);</span><br><span class="line">End;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在代表样品的序号后用中括号[&amp;]提供注释信息，多个注释用逗号分隔，如果提供的注释信息值是区间，用大括号包含区间。</p>
<h3 id="2-2-2-ggtree画树"><a href="#2-2-2-ggtree画树" class="headerlink" title="2.2.2. ggtree画树"></a>2.2.2. ggtree画树</h3><p>ggtree函数是ggplot()的扩展，ggtree()相当于<code>ggplot() + geom_tree() + xlab(NA) + ylab(NA) + theme_tree()</code>的简单组合。ggplot2可添加的图层都可以直接应用于ggtree。</p>
<h4 id="2-2-2-1-基础画树"><a href="#2-2-2-1-基础画树" class="headerlink" title="2.2.2.1. 基础画树"></a>2.2.2.1. 基础画树</h4><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">library<span class="punctuation">(</span>ggtree<span class="punctuation">)</span></span><br><span class="line">ggtree<span class="punctuation">(</span>tree<span class="punctuation">)</span> <span class="comment">#默认参数画树</span></span><br></pre></td></tr></table></figure>

<h4 id="2-2-2-2-基础注释"><a href="#2-2-2-2-基础注释" class="headerlink" title="2.2.2.2. 基础注释"></a>2.2.2.2. 基础注释</h4><ol>
<li><p>基础注释函数用法<br>包含注释函数的基本参数用法</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">ggtree<span class="punctuation">(</span>tree<span class="punctuation">)</span> <span class="punctuation">\</span> <span class="comment">#画树 </span></span><br><span class="line"><span class="operator">+</span> geom_tiplab<span class="punctuation">(</span><span class="punctuation">)</span> <span class="punctuation">\</span> <span class="comment"># 末端节点标上物种</span></span><br><span class="line"><span class="operator">+</span> geom_rootedge<span class="punctuation">(</span><span class="punctuation">)</span> <span class="punctuation">\</span><span class="comment">#添加根节点的枝长线，如果树文件中有根节点枝长则直接可使用</span></span><br><span class="line"><span class="operator">+</span> geom_point2<span class="punctuation">(</span><span class="punctuation">)</span> <span class="punctuation">\</span> <span class="comment">#节点上标记圆点</span></span><br><span class="line"><span class="operator">+</span> geom_text2<span class="punctuation">(</span>aes<span class="punctuation">(</span>label<span class="operator">=</span>node<span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">\</span> <span class="comment">#节点上做文字标记。label指定内容，这里指定节点上标记节点号，可以用这个确定树图上对应的节点号</span></span><br><span class="line"><span class="operator">+</span> geom_label2<span class="punctuation">(</span>aes<span class="punctuation">(</span>label<span class="operator">=</span>node<span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">\</span><span class="comment">#节点上做标签标记。label指定内容，这里指定节点上标记节点号。</span></span><br><span class="line"><span class="operator">+</span> geom_cladelabel<span class="punctuation">(</span><span class="number">20</span><span class="punctuation">,</span>label<span class="operator">=</span><span class="string">&quot;legumes&quot;</span><span class="punctuation">,</span>angle<span class="operator">=</span><span class="number">90</span><span class="punctuation">)</span> <span class="punctuation">\</span><span class="comment">#用条带和文本注释一个clade(node20)，label指定文本内容，angle指定文本角度</span></span><br><span class="line"><span class="operator">+</span> geom_strip<span class="punctuation">(</span><span class="number">9</span><span class="punctuation">,</span><span class="number">10</span><span class="punctuation">,</span>label<span class="operator">=</span><span class="string">&quot;legumes&quot;</span><span class="punctuation">)</span> <span class="punctuation">\</span><span class="comment">#用条带指定node9到node10的位置，label指定文字内容</span></span><br><span class="line"><span class="operator">+</span> geom_hilight<span class="punctuation">(</span>node<span class="operator">=</span><span class="number">20</span><span class="punctuation">)</span> <span class="punctuation">\</span><span class="comment">#用矩形高亮node20号分支，用法和geom_highlight()好像是一样的</span></span><br><span class="line"><span class="operator">+</span> geom_range<span class="punctuation">(</span><span class="string">&quot;length_0.95_HPD&quot;</span><span class="punctuation">)</span> <span class="punctuation">\</span><span class="comment">#在节点上画长条形的分歧时间的95%置信范围，值来自树文件中的length_0.95_HPD注释值</span></span><br><span class="line"><span class="operator">+</span> geom_taxallink<span class="punctuation">(</span>taxa1<span class="operator">=</span><span class="number">12</span><span class="punctuation">,</span> taxa2<span class="operator">=</span><span class="number">20</span><span class="punctuation">)</span> <span class="punctuation">\</span><span class="comment">#用曲线连接node12和node20</span></span><br><span class="line"><span class="operator">+</span> geom_treescale<span class="punctuation">(</span><span class="punctuation">)</span> <span class="punctuation">\</span><span class="comment">#添加比例尺</span></span><br><span class="line"><span class="operator">+</span> xlim<span class="punctuation">(</span><span class="literal">NA</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">)</span> <span class="punctuation">\</span><span class="comment">#如果内容超出边界，就用xlim拓展显示x轴的范围</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>常用注释参数<br>包含注释函数的常用参数用法</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ggtree<span class="punctuation">(</span>tree<span class="punctuation">,</span> layout<span class="operator">=</span><span class="string">&quot;circular&quot;</span><span class="punctuation">,</span> size<span class="operator">=</span><span class="number">0.8</span><span class="punctuation">,</span> branch.length<span class="operator">=</span><span class="string">&#x27;none&#x27;</span><span class="punctuation">)</span> <span class="punctuation">\</span> <span class="comment">#画树，layout指定布局类型，默认是rectangular；size指定枝的粗细；branch.length指定无枝长信息  </span></span><br><span class="line"><span class="operator">+</span> geom_tiplab<span class="punctuation">(</span>color<span class="operator">=</span><span class="string">&quot;black&quot;</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">4</span><span class="punctuation">,</span> hjust <span class="operator">=</span> <span class="operator">-</span><span class="number">0.1</span><span class="punctuation">,</span> align<span class="operator">=</span><span class="built_in">T</span><span class="punctuation">,</span> linesize<span class="operator">=</span><span class="number">0.7</span><span class="punctuation">)</span> <span class="punctuation">\</span> <span class="comment"># 末端节点标上物种，size文字大小，hjust是离进化枝线条的距离，align=T文字间左对齐，linesize设置虚线尺寸。</span></span><br><span class="line"><span class="operator">+</span> geom_rootedge<span class="punctuation">(</span>rootedge <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span>size<span class="operator">=</span><span class="number">1</span><span class="punctuation">)</span> <span class="punctuation">\</span><span class="comment">#添加根节点的枝长线，如果树文件中有根节点枝长则直接可使用，否则可以用rootedge设置根节点枝长(不设置为0)，size设置粗细。结合xlim来显示。</span></span><br><span class="line"><span class="operator">+</span> geom_point2<span class="punctuation">(</span>color<span class="operator">=</span><span class="string">&quot;#6FE1F8&quot;</span><span class="punctuation">,</span> size<span class="operator">=</span><span class="number">5</span><span class="punctuation">,</span> alpha<span class="operator">=</span><span class="number">0.7</span><span class="punctuation">)</span> <span class="punctuation">\</span> <span class="comment">#所有节点上标记圆点，配色和透明度</span></span><br><span class="line"><span class="operator">+</span> geom_point2<span class="punctuation">(</span>aes<span class="punctuation">(</span>subset<span class="operator">=</span><span class="punctuation">(</span>node<span class="operator">==</span><span class="number">16</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span> color<span class="operator">=</span><span class="string">&#x27;darkgreen&#x27;</span><span class="punctuation">,</span> size<span class="operator">=</span><span class="number">5</span><span class="punctuation">)</span> <span class="punctuation">\</span><span class="comment">#在16号节点标记绿色圆点。其中subset是取子集，符合条件的才注释；color设置颜色，size设置大小。</span></span><br><span class="line"><span class="operator">+</span> geom_text2<span class="punctuation">(</span>aes<span class="punctuation">(</span>label<span class="operator">=</span>branch.length<span class="punctuation">,</span>hjust<span class="operator">=</span><span class="operator">-</span><span class="number">0.1</span><span class="punctuation">)</span><span class="punctuation">,</span>size<span class="operator">=</span><span class="number">3</span><span class="punctuation">,</span> fontface <span class="operator">=</span> <span class="string">&quot;bold&quot;</span><span class="punctuation">)</span> <span class="punctuation">\</span><span class="comment">#节点上标记枝长；size设置大小，fontface设置文本加粗显示</span></span><br><span class="line"><span class="operator">+</span> geom_text2<span class="punctuation">(</span>aes<span class="punctuation">(</span>subset<span class="operator">=</span><span class="operator">!</span>isTip<span class="punctuation">,</span> label<span class="operator">=</span>node<span class="punctuation">)</span><span class="punctuation">,</span> hjust<span class="operator">=</span><span class="operator">-</span><span class="number">0.3</span><span class="punctuation">,</span> size<span class="operator">=</span><span class="number">3</span><span class="punctuation">,</span> color<span class="operator">=</span><span class="string">&quot;deepskyblue4&quot;</span><span class="punctuation">)</span>  <span class="punctuation">\</span> <span class="comment">#非tip节点标记上node号</span></span><br><span class="line"><span class="operator">+</span> geom_label2<span class="punctuation">(</span>aes<span class="punctuation">(</span>x<span class="operator">=</span><span class="number">0.79</span><span class="punctuation">,</span>label<span class="operator">=</span>D<span class="punctuation">)</span><span class="punctuation">,</span>color<span class="operator">=</span><span class="string">&quot;black&quot;</span><span class="punctuation">,</span>vjust<span class="operator">=</span><span class="operator">-</span><span class="number">0.2</span><span class="punctuation">,</span>fill<span class="operator">=</span><span class="string">&quot;#7FFF00&quot;</span><span class="punctuation">,</span>alpha<span class="operator">=</span><span class="number">0.6</span><span class="punctuation">)</span> <span class="punctuation">\</span><span class="comment">#做标记,aes里的x指定位置，label指定内容</span></span><br><span class="line"><span class="operator">+</span> geom_strip<span class="punctuation">(</span><span class="number">9</span><span class="punctuation">,</span><span class="number">10</span><span class="punctuation">,</span>label<span class="operator">=</span><span class="string">&quot;legumes&quot;</span><span class="punctuation">,</span>offset <span class="operator">=</span> <span class="number">0.06</span><span class="punctuation">,</span>offset.text <span class="operator">=</span> <span class="number">0.012</span><span class="punctuation">,</span>color <span class="operator">=</span> <span class="string">&quot;#FF6100&quot;</span><span class="punctuation">,</span>barsize <span class="operator">=</span> <span class="number">1.5</span><span class="punctuation">,</span>fontsize <span class="operator">=</span> <span class="number">5</span><span class="punctuation">,</span>angle <span class="operator">=</span> <span class="number">90</span><span class="punctuation">,</span>hjust <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">)</span> <span class="punctuation">\</span><span class="comment">#用条带指定node9和node10之间的分支clade，label指定文字内容，offset指定条带和文字与末端节点的距离，offset.text指定文字与条带的距离，barsize指定条带尺寸，fontsize指定文字尺寸，hjust指定文字位置</span></span><br><span class="line"><span class="operator">+</span> geom_hilight<span class="punctuation">(</span>node<span class="operator">=</span><span class="number">15</span><span class="punctuation">,</span>fill<span class="operator">=</span><span class="string">&quot;firebrick&quot;</span><span class="punctuation">,</span>alpha<span class="operator">=</span><span class="number">0.6</span><span class="punctuation">)</span> <span class="punctuation">\</span><span class="comment">#用矩形高亮一个分支</span></span><br><span class="line"><span class="operator">+</span> geom_range<span class="punctuation">(</span><span class="string">&quot;length_0.95_HPD&quot;</span><span class="punctuation">,</span> color<span class="operator">=</span><span class="string">&#x27;red&#x27;</span><span class="punctuation">,</span> size<span class="operator">=</span><span class="number">2</span><span class="punctuation">,</span> alpha<span class="operator">=</span><span class="number">.5</span><span class="punctuation">,</span> center<span class="operator">=</span><span class="string">&#x27;length&#x27;</span><span class="punctuation">)</span> <span class="comment">#在节点上画长条形的分歧时间的95%置信范围，值来自树文件中的length_0.95_HPD注释值，让中心点位于length注释值</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>其他设置</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ggtree<span class="punctuation">(</span>tree<span class="punctuation">)</span></span><br><span class="line"><span class="operator">+</span> scale_x_reverse<span class="punctuation">(</span><span class="punctuation">)</span> <span class="comment">#反转x轴</span></span><br><span class="line"><span class="operator">+</span> coord_flip<span class="punctuation">(</span><span class="punctuation">)</span> <span class="comment">#置换x轴和y轴</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="2-2-2-3-改变树的结构"><a href="#2-2-2-3-改变树的结构" class="headerlink" title="2.2.2.3. 改变树的结构"></a>2.2.2.3. 改变树的结构</h4><p>改变树的结构包括取子树(viewClade)，坍塌(collapse)，扩展(expand)，旋转(rotate)，分组(groupClade)等操作，下面两种函数用法是等价的：</p>
<ul>
<li>rotate(p,node&#x3D;12)</li>
<li>p %&gt;% rotate(node&#x3D;12)</li>
</ul>
<p>当需要多次改变树的结构时，推荐第二种用法，比如<code>p2 &lt;- p1 %&gt;% flip(37,48) %&gt;% flip(3,4) %&gt;% flip(13,14) %&gt;% flip(25,26) %&gt;% flip(28,29) %&gt;% flip(55,56)</code>即可依次改变。</p>
<ol>
<li><p>显示子树</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">p <span class="operator">&lt;-</span> ggtree<span class="punctuation">(</span>tree<span class="punctuation">)</span><span class="operator">+</span>geom_tiplab<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line">viewClade<span class="punctuation">(</span>p<span class="punctuation">,</span> MRCA<span class="punctuation">(</span>p<span class="punctuation">,</span> <span class="number">10</span>，<span class="number">15</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="comment">#显示10-15节点的子树部分</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>旋转枝</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">flip<span class="punctuation">(</span>p<span class="punctuation">,</span> <span class="number">15</span><span class="punctuation">,</span> <span class="number">17</span><span class="punctuation">)</span> <span class="comment">#交换15号节点和17号节点代表的枝的位置，15和17号共享同一个祖先节点16。</span></span><br><span class="line">rotate<span class="punctuation">(</span>p<span class="punctuation">,</span> <span class="number">16</span><span class="punctuation">)</span> <span class="comment">#在16号节点把上下两个枝镜像翻转180°，与flip的区别是rotate同时改变了15和17号节点内所有子节点的顺序</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>坍塌和扩展枝</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">p2 <span class="operator">&lt;-</span> collapse<span class="punctuation">(</span>p<span class="punctuation">,</span> node<span class="operator">=</span><span class="number">16</span><span class="punctuation">)</span> <span class="operator">+</span> geom_point2<span class="punctuation">(</span>aes<span class="punctuation">(</span>subset<span class="operator">=</span><span class="punctuation">(</span>node<span class="operator">==</span><span class="number">16</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span> shape<span class="operator">=</span><span class="number">21</span><span class="punctuation">,</span> size<span class="operator">=</span><span class="number">5</span><span class="punctuation">,</span> fill<span class="operator">=</span><span class="string">&#x27;green&#x27;</span><span class="punctuation">)</span> <span class="comment">#坍塌21号节点，用绿色圆点标记</span></span><br><span class="line">expand<span class="punctuation">(</span>p2<span class="punctuation">,</span> node<span class="operator">=</span><span class="number">21</span><span class="punctuation">)</span> <span class="comment">#把p2坍塌的21号节点扩展开</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>缩小和放大枝</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">scaleClade<span class="punctuation">(</span>p<span class="punctuation">,</span> node<span class="operator">=</span><span class="number">15</span><span class="punctuation">,</span> scale<span class="operator">=</span><span class="number">0.1</span><span class="punctuation">)</span> <span class="comment">#缩小15号节点及子节点的枝，压缩尺度为0.1，拓扑和枝长仍然保留，但枝间距缩小为原来的0.1倍。常用于tip比较多的系统树上缩小不重要的部分，但不坍塌。</span></span><br><span class="line">scaleClade<span class="punctuation">(</span>p<span class="punctuation">,</span> node<span class="operator">=</span><span class="number">17</span><span class="punctuation">,</span> scale<span class="operator">=</span><span class="number">1.5</span><span class="punctuation">)</span> <span class="comment">#放大17号节点及子节点的枝，放大尺度为1.5，枝间距放大为原来的1.5倍。常用于突出重要的枝。</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>分组<br>单系分组用groupClade，多系&#x2F;并系分组用groupOTU。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">p3 <span class="operator">&lt;-</span> groupClade<span class="punctuation">(</span>p<span class="punctuation">,</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">15</span><span class="punctuation">,</span><span class="number">17</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="comment">#节点15及子节点分为一组，节点17及子节点分为一组，赋予group属性，适用单系分组。</span></span><br><span class="line">ggtree<span class="punctuation">(</span>p3<span class="punctuation">,</span> aes<span class="punctuation">(</span>color<span class="operator">=</span>group<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span> scale_color_manual<span class="punctuation">(</span>values<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;black&quot;</span><span class="punctuation">,</span> <span class="string">&quot;red&quot;</span><span class="punctuation">,</span> <span class="string">&quot;blue&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="comment">#用group属性注释枝的颜色，默认颜色为黑色，15节点代表的组为红色，17节点代表的组为蓝色</span></span><br><span class="line"></span><br><span class="line">p4 <span class="operator">&lt;-</span> groupOTU<span class="punctuation">(</span>p<span class="punctuation">,</span> focus<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;A&quot;</span><span class="punctuation">,</span><span class="string">&quot;D&quot;</span><span class="punctuation">,</span><span class="string">&quot;G&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="comment">#A,D,G分为一组，赋予group属性</span></span><br><span class="line">ggtree<span class="punctuation">(</span>p4<span class="punctuation">,</span> aes<span class="punctuation">(</span>color<span class="operator">=</span>group<span class="punctuation">)</span><span class="punctuation">)</span> <span class="comment">#用group属性注释枝的颜色，A,D,G所在的枝和共享的枝一种颜色，其他枝另一种颜色。A,D,G可以是多系/并系。</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="2-2-2-4-可视化数据并与系统发育树关联-——-facet-plot"><a href="#2-2-2-4-可视化数据并与系统发育树关联-——-facet-plot" class="headerlink" title="2.2.2.4. 可视化数据并与系统发育树关联 —— facet_plot"></a>2.2.2.4. 可视化数据并与系统发育树关联 —— facet_plot</h4><p>可能有不同的数据类型，并希望将它们可视化并与树关联对齐，可用facet_plot函数来处理。</p>
<p>可视化图的类型：点图dotplot&#x2F;直方图barplot&#x2F;堆叠图stacked barplot&#x2F;热图&#x2F;箱线图boxplot。</p>
<p>ggtree中定义了操作符%&lt;+%，来添加数据。添加之后，用户的数据对ggplot是可见的。可以用于树的注释。</p>
<ol>
<li>可视化点图dotplot —— geom_point<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">tr <span class="operator">&lt;-</span> rtree<span class="punctuation">(</span><span class="number">30</span><span class="punctuation">)</span> <span class="comment"># 用treeio的rtree函数生成30个tip的随机树  </span></span><br><span class="line">p <span class="operator">&lt;-</span> ggtree<span class="punctuation">(</span>tr<span class="punctuation">)</span></span><br><span class="line">d1 <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span>id<span class="operator">=</span>tr<span class="operator">$</span>tip.label<span class="punctuation">,</span> location<span class="operator">=</span>sample<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;GZ&quot;</span><span class="punctuation">,</span> <span class="string">&quot;HK&quot;</span><span class="punctuation">,</span> <span class="string">&quot;CZ&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="number">30</span><span class="punctuation">,</span> replace<span class="operator">=</span><span class="literal">TRUE</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="comment">#从(&quot;GZ&quot;, &quot;HK&quot;, &quot;CZ&quot;)中随机生成30个采样地点location数据  </span></span><br><span class="line">p1<span class="operator">&lt;-</span> p <span class="operator">%&lt;+%</span> d1 <span class="operator">+</span> geom_tippoint<span class="punctuation">(</span>aes<span class="punctuation">(</span>color<span class="operator">=</span>location<span class="punctuation">)</span><span class="punctuation">)</span> <span class="comment">#给树的端点根据location着色  </span></span><br><span class="line"></span><br><span class="line">d2 <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span>id<span class="operator">=</span>tr<span class="operator">$</span>tip.label<span class="punctuation">,</span> val<span class="operator">=</span>rnorm<span class="punctuation">(</span><span class="number">30</span><span class="punctuation">,</span> sd<span class="operator">=</span><span class="number">3</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="comment">#生成两列数据，分别是tip.label和随机生成的30个sd为3的数据值，均值mean默认为0  </span></span><br><span class="line">p2 <span class="operator">&lt;-</span> facet_plot<span class="punctuation">(</span>p1<span class="punctuation">,</span> panel<span class="operator">=</span><span class="string">&quot;dot&quot;</span><span class="punctuation">,</span> data<span class="operator">=</span>d2<span class="punctuation">,</span> geom<span class="operator">=</span>geom_point<span class="punctuation">,</span> aes<span class="punctuation">(</span>x<span class="operator">=</span>val<span class="punctuation">)</span><span class="punctuation">,</span> color<span class="operator">=</span><span class="string">&#x27;firebrick&#x27;</span><span class="punctuation">)</span> <span class="operator">+</span> theme_tree2<span class="punctuation">(</span><span class="punctuation">)</span> <span class="comment">#用ggtree的facet_plot的geom_point函数画点图  </span></span><br></pre></td></tr></table></figure></li>
</ol>
<img src="https://guangchuangyu.github.io/blog_images/Bioconductor/ggtree/facet_plot_dot2.png" width=100% height=70% title="facet_plot_p2.png" align=center/>

<p><strong><p align="center">Figure 1. p2 dotplot</strong><br>from <a target="_blank" rel="noopener" href="https://guangchuangyu.github.io/blog_images/Bioconductor/ggtree/facet_plot_dot2.png">guangchuangyu’s blog</a></p></p>
<ol start="2">
<li>可视化堆叠直方图stacked barplot —— geom_barh<br>大多ggplot2的geom绘制垂直版本的图形对象，通过ggstance包可以制作水平版本的数据图geom，方便画直方图&#x2F;堆叠直方图&#x2F;热图&#x2F;箱线图与系统发育树对应。<br>包括geom_barh()，geom_histogramh()，geom_linerangeh()，geom_pointrangeh()，geom_errorbarh()，geom_crossbarh()，geom_boxploth()，geom_violinh()。<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">library<span class="punctuation">(</span>ggstance<span class="punctuation">)</span></span><br><span class="line">d3 <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span>id <span class="operator">=</span> <span class="built_in">rep</span><span class="punctuation">(</span>tr<span class="operator">$</span>tip.label<span class="punctuation">,</span> each<span class="operator">=</span><span class="number">2</span><span class="punctuation">)</span><span class="punctuation">,</span>  </span><br><span class="line">					value <span class="operator">=</span> <span class="built_in">abs</span><span class="punctuation">(</span>rnorm<span class="punctuation">(</span><span class="number">60</span><span class="punctuation">,</span> mean<span class="operator">=</span><span class="number">100</span><span class="punctuation">,</span> sd<span class="operator">=</span><span class="number">50</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span>  </span><br><span class="line">					category <span class="operator">=</span> <span class="built_in">rep</span><span class="punctuation">(</span><span class="built_in">LETTERS</span><span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span><span class="number">2</span><span class="punctuation">]</span><span class="punctuation">,</span> <span class="number">30</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="comment">#随机生成3列数据，分别是tip.label,随机值,代表category的A/B  </span></span><br><span class="line">p3 <span class="operator">&lt;-</span> facet_plot<span class="punctuation">(</span>p2<span class="punctuation">,</span> panel <span class="operator">=</span> <span class="string">&#x27;Stacked Barplot&#x27;</span><span class="punctuation">,</span> data <span class="operator">=</span> d3<span class="punctuation">,</span>   </span><br><span class="line">				geom <span class="operator">=</span> geom_barh<span class="punctuation">,</span> <span class="comment">#用geom_barh画水平版本的堆叠直方图  </span></span><br><span class="line">				mapping <span class="operator">=</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> value<span class="punctuation">,</span> fill <span class="operator">=</span> as.factor<span class="punctuation">(</span>category<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span>   </span><br><span class="line">				stat<span class="operator">=</span><span class="string">&#x27;identity&#x27;</span> <span class="punctuation">)</span>   </span><br></pre></td></tr></table></figure></li>
</ol>
<img src="https://guangchuangyu.github.io/blog_images/Bioconductor/ggtree/facet_plot_bar2.png" title="facet_plot_p3.png" width="100%" height="70%" />

<p><strong><p align="center">Figure 2. p3 barplot</strong><br>from <a target="_blank" rel="noopener" href="https://guangchuangyu.github.io/blog_images/Bioconductor/ggtree/facet_plot_bar2.png">guangchuangyu blog</a></p></p>
<ol start="3">
<li>可视化箱线图boxplot —— geom_boxploth<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">d4 <span class="operator">=</span> data.frame<span class="punctuation">(</span>id<span class="operator">=</span><span class="built_in">rep</span><span class="punctuation">(</span>tr<span class="operator">$</span>tip.label<span class="punctuation">,</span> each<span class="operator">=</span><span class="number">20</span><span class="punctuation">)</span><span class="punctuation">,</span>   </span><br><span class="line">				val<span class="operator">=</span>as.vector<span class="punctuation">(</span>sapply<span class="punctuation">(</span><span class="number">1</span><span class="operator">:</span><span class="number">30</span><span class="punctuation">,</span> <span class="keyword">function</span><span class="punctuation">(</span>i<span class="punctuation">)</span>   </span><br><span class="line">								rnorm<span class="punctuation">(</span><span class="number">20</span><span class="punctuation">,</span> mean<span class="operator">=</span>i<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span>  </span><br><span class="line">				<span class="punctuation">)</span>				</span><br><span class="line">p4 <span class="operator">&lt;-</span> facet_plot<span class="punctuation">(</span>p3<span class="punctuation">,</span> panel<span class="operator">=</span><span class="string">&quot;Boxplot&quot;</span><span class="punctuation">,</span> data<span class="operator">=</span>d4<span class="punctuation">,</span> geom_boxploth<span class="punctuation">,</span>   </span><br><span class="line">			mapping <span class="operator">=</span> aes<span class="punctuation">(</span>x<span class="operator">=</span>val<span class="punctuation">,</span> group<span class="operator">=</span>label<span class="punctuation">,</span> color<span class="operator">=</span>location<span class="punctuation">)</span><span class="punctuation">)</span> <span class="comment">#用geom_boxploth画水平版本的箱线图</span></span><br></pre></td></tr></table></figure></li>
</ol>
<img src="https://guangchuangyu.github.io/blog_images/Bioconductor/ggtree/facet_plot_boxplot2.png" title="facet_plot_p4.png" width="100%" height="70%" />

<p><strong><p align="center">Figure 3. p4 boxplot</strong><br>from <a target="_blank" rel="noopener" href="https://guangchuangyu.github.io/blog_images/Bioconductor/ggtree/facet_plot_boxplot2.png">guangchuangyu blog</a></p></p>
<h4 id="2-2-2-5-时序树-chronogram"><a href="#2-2-2-5-时序树-chronogram" class="headerlink" title="2.2.2.5. 时序树(chronogram)"></a>2.2.2.5. 时序树(chronogram)</h4><p>时序树上每个节点的数字代表的是分歧时间，端点一般对齐（因为端点的所有样本都对应当下的采样时间），画时序图需要先有时间标定的树文件，树上的枝长代表时长，一般会再添加时间尺度轴。</p>
<ol>
<li>画时序树</li>
</ol>
<ul>
<li>通过<code>ggtree(tree, mrsd=&quot;2020-01-01&quot;)</code>中的mrsd指定采样日期(即tip端点时间)，mrsd代表most recent sampling date,指定采样时间</li>
<li>通过<code>+theme_tree2()</code>来在树下添加一个时间尺度轴，默认是以年为单位</li>
<li>可用deeptime包向ggtree添加地质时间尺度</li>
</ul>
<p>实现采样时间(mrsd)和内部节点时间来缩放树</p>
<ol start="2">
<li>读取时序树<br>读取时序树与读取任何系统发育树的方法一样，读取任何时间代表枝长的树文件即可。</li>
</ol>
<ul>
<li>可以用treeio解析估计时间的软件(例如beast，r8s)输出的时序树；</li>
<li>也可以把时间写入枝长位置，以文本的形式读取时序树；</li>
</ul>
<ol start="3">
<li>时间尺度轴的变化</li>
</ol>
<ul>
<li><p>直接用<code>theme_tree2() +scale_x_continuous()</code>来设置时间尺度轴的显示</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ggtree<span class="punctuation">(</span>tree<span class="punctuation">)</span> <span class="operator">+</span> theme_tree2<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span>scale_x_continuous<span class="punctuation">(</span>limits<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="operator">-</span><span class="number">1</span><span class="punctuation">,</span><span class="number">4</span><span class="punctuation">)</span><span class="punctuation">,</span>breaks <span class="operator">=</span> seq<span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span><span class="number">4</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">)</span><span class="punctuation">,</span>labels <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">4</span><span class="punctuation">,</span><span class="number">3</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span><span class="number">0</span><span class="punctuation">)</span><span class="punctuation">,</span>expand <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0.1</span><span class="punctuation">,</span><span class="number">0.1</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span> geom_treescale<span class="punctuation">(</span>x<span class="operator">=</span><span class="number">3</span><span class="punctuation">,</span>y<span class="operator">=</span><span class="number">20</span><span class="punctuation">,</span>color<span class="operator">=</span><span class="string">&quot;red&quot;</span><span class="punctuation">)</span> <span class="comment">#画树，theme_tree2()在树下方加时间尺度轴，这里假设是[0,4]，用scale_x_continuous()限制时间尺度轴的显示和刻度，limits=c(-1,4)设置尺度轴显示范围为-1到4(同样也是图的横向显示范围)，breaks设置值的显示范围为0到4，每隔1显示一个值，labels设置显示的值，可以直接设定c(4,3,2,1,0)使时间尺度轴倒序显示，expand设置绘图左右范围的空白大小；geom_treescale()在右上角添加比例尺</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>用<code>revts</code>设置时间尺度轴翻转</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">p <span class="operator">&lt;-</span> ggtree<span class="punctuation">(</span>tree<span class="punctuation">)</span> <span class="operator">+</span> theme_tree2<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line">p1 <span class="operator">&lt;-</span> revts<span class="punctuation">(</span>p<span class="punctuation">)</span> <span class="comment">#翻转时间尺度轴，比如[0,4]翻转成[-4,0]；注意使用revts后，xlim的范围也要相应调整。</span></span><br><span class="line">library<span class="punctuation">(</span>ggplot2<span class="punctuation">)</span> <span class="comment">#scale_x_continuous是ggplot2的函数</span></span><br><span class="line">p2 <span class="operator">&lt;-</span> p <span class="operator">+</span> scale_x_continuous<span class="punctuation">(</span>labels <span class="operator">=</span> <span class="built_in">abs</span><span class="punctuation">)</span> <span class="comment">#把时间尺度轴的标签显示为绝对值abs的形式，scale_x_continuous是ggplot的函数</span></span><br><span class="line">p3 <span class="operator">&lt;-</span> revts<span class="punctuation">(</span>p2<span class="punctuation">)</span> <span class="comment">#把p2时间尺度轴翻转，由于p2用了绝对值，效果是把[0,4]翻转成了[4,0]</span></span><br><span class="line">p4 <span class="operator">&lt;-</span> p1 <span class="operator">+</span> scale_x_continuous<span class="punctuation">(</span>breaks<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="operator">-</span><span class="number">4</span><span class="operator">:</span><span class="number">0</span><span class="punctuation">)</span><span class="punctuation">,</span> labels<span class="operator">=</span><span class="built_in">abs</span><span class="punctuation">(</span><span class="operator">-</span><span class="number">4</span><span class="operator">:</span><span class="number">0</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="comment">#把时间尺度轴的标签显示为绝对值abs的形式，即把[-4,0]显示成[4,0]</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="2-2-2-6-系统发育网-phylogenetic-reticulum-——-geom-taxalink"><a href="#2-2-2-6-系统发育网-phylogenetic-reticulum-——-geom-taxalink" class="headerlink" title="2.2.2.6. 系统发育网(phylogenetic reticulum) —— geom_taxalink"></a>2.2.2.6. 系统发育网(phylogenetic reticulum) —— geom_taxalink</h4><p>系统发育网一般是在系统发育树绘制的基础上添加物种间的杂交和基因流关系。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ggtree<span class="punctuation">(</span>tree<span class="punctuation">)</span> <span class="operator">+</span> geom_tiplab<span class="punctuation">(</span><span class="punctuation">)</span>  </span><br><span class="line"><span class="operator">+</span> geom_taxalink<span class="punctuation">(</span><span class="string">&#x27;A&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;E&#x27;</span><span class="punctuation">)</span> <span class="comment">#在tipA和E之间添加关联线，默认是黑色实线。  </span></span><br><span class="line"><span class="operator">+</span> geom_taxalink<span class="punctuation">(</span><span class="string">&#x27;F&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;K&#x27;</span><span class="punctuation">,</span> color<span class="operator">=</span><span class="string">&#x27;red&#x27;</span><span class="punctuation">,</span> linetype <span class="operator">=</span> <span class="string">&#x27;dashed&#x27;</span><span class="punctuation">,</span> arrow<span class="operator">=</span>grid<span class="operator">::</span>arrow<span class="punctuation">(</span><span class="built_in">length</span><span class="operator">=</span>grid<span class="operator">::</span>unit<span class="punctuation">(</span><span class="number">0.02</span><span class="punctuation">,</span> <span class="string">&quot;npc&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="comment">#在tipF和K之间添加关联线，红色虚线，并添加F到K的箭头，箭头大小为0.02npc。  </span></span><br></pre></td></tr></table></figure>

<h4 id="2-2-2-7-多棵图共同展示"><a href="#2-2-2-7-多棵图共同展示" class="headerlink" title="2.2.2.7. 多棵图共同展示"></a>2.2.2.7. 多棵图共同展示</h4><ol>
<li><p>multiPhylo图<br>多棵树并列展示。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">trees <span class="operator">&lt;-</span> lapply<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">10</span><span class="punctuation">,</span> <span class="number">20</span><span class="punctuation">,</span> <span class="number">40</span><span class="punctuation">)</span><span class="punctuation">,</span> rtree<span class="punctuation">)</span> <span class="comment">#随机生成3棵树，节点分别为10，20，40  </span></span><br><span class="line"><span class="built_in">class</span><span class="punctuation">(</span>trees<span class="punctuation">)</span> <span class="operator">&lt;-</span> <span class="string">&quot;multiPhylo&quot;</span>  </span><br><span class="line">ggtree<span class="punctuation">(</span>trees<span class="punctuation">)</span> <span class="operator">+</span> facet_wrap<span class="punctuation">(</span><span class="operator">~</span>.id<span class="punctuation">,</span> scale<span class="operator">=</span><span class="string">&quot;free&quot;</span><span class="punctuation">)</span> <span class="operator">+</span> geom_tiplab<span class="punctuation">(</span><span class="punctuation">)</span> <span class="comment">#分面展示3棵树  </span></span><br><span class="line"></span><br><span class="line">btrees <span class="operator">=</span> read.tree<span class="punctuation">(</span>system.file<span class="punctuation">(</span><span class="string">&quot;extdata/RAxML&quot;</span><span class="punctuation">,</span> <span class="string">&quot;RAxML_bootstrap.H3&quot;</span><span class="punctuation">,</span> package<span class="operator">=</span><span class="string">&quot;ggtree&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="comment">#读取系统的100棵树  </span></span><br><span class="line">ggtree<span class="punctuation">(</span>btrees<span class="punctuation">)</span> <span class="operator">+</span> facet_wrap<span class="punctuation">(</span><span class="operator">~</span>.id<span class="punctuation">,</span> ncol<span class="operator">=</span><span class="number">10</span><span class="punctuation">)</span> <span class="comment">#分面展示100棵树，每行10棵。  </span></span><br></pre></td></tr></table></figure>
</li>
<li><p>DensityTree图<br>多棵树重叠展示。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">trees <span class="operator">&lt;-</span> read.tree<span class="punctuation">(</span>system.file<span class="punctuation">(</span><span class="string">&quot;extdata/RAxML&quot;</span><span class="punctuation">,</span> <span class="string">&quot;RAxML_bootstrap.H3&quot;</span><span class="punctuation">,</span> package<span class="operator">=</span><span class="string">&quot;treeio&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="comment">#读取系统自带树文件RAxML_bootstrap.H3，包含100棵树。  </span></span><br><span class="line">ggdensitree<span class="punctuation">(</span>trees<span class="punctuation">,</span> alpha<span class="operator">=</span><span class="number">.3</span><span class="punctuation">,</span> colour<span class="operator">=</span><span class="string">&#x27;steelblue&#x27;</span><span class="punctuation">)</span> <span class="operator">+</span> geom_tiplab<span class="punctuation">(</span>size<span class="operator">=</span><span class="number">3</span><span class="punctuation">)</span> <span class="operator">+</span> xlim<span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">45</span><span class="punctuation">)</span> <span class="comment">#重叠多棵树。bootstrap值高的线条一致性，低的线条较乱。  </span></span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="2-2-2-8-一个生成树的例子"><a href="#2-2-2-8-一个生成树的例子" class="headerlink" title="2.2.2.8. 一个生成树的例子"></a>2.2.2.8. 一个生成树的例子</h4><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">library<span class="punctuation">(</span>treeio<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>ggtree<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">treetext<span class="operator">&lt;-</span><span class="string">&quot;((((Mc:0.418672[&amp;&amp;NHX:I=+5728:D=-1170:G=Malvids],Eg:0.201388[&amp;&amp;NHX:I=+1420:D=-2519:G=Malvids])[&amp;&amp;NHX:C=1]:0.148853,((Pt:0.219587[&amp;&amp;NHX:I=+5355:D=-1003:G=Fabids],(Cs:0.209405[&amp;&amp;NHX:I=+1026:D=-3516:G=Malvids],(Gr:0.224188[&amp;&amp;NHX:I=+4875:D=-998:G=Malvids],At:0.492461[&amp;&amp;NHX:I=+1776:D=-2891:G=Malvids]):0.027774[&amp;&amp;NHX:C=2]):0.012564[&amp;&amp;NHX:C=3]):0.019343[&amp;&amp;NHX:C=4],(Pp:0.194515[&amp;&amp;NHX:I=+1159:D=-2949:G=Fabids],(Mt:0.354580[&amp;&amp;NHX:I=+3310:D=-1984:G=Fabids],Cl:0.338644[&amp;&amp;NHX:I=+794:D=-3735:G=Fabids]):0.022063[&amp;&amp;NHX:C=5]):0.019111[&amp;&amp;NHX:C=6]):0.011710[&amp;&amp;NHX:C=7]):0.029914[&amp;&amp;NHX:C=8],Vv:0.169100[&amp;&amp;NHX:I=+1522:D=-3045:G=Vitales]):0.241611[&amp;&amp;NHX:C=9],Mg:0.241611[&amp;&amp;NHX:I=+2278:D=-1909:G=Asterids])[&amp;&amp;NHX:C=10];&quot;</span>  </span><br><span class="line">tree <span class="operator">&lt;-</span> read.nhx<span class="punctuation">(</span>textConnection<span class="punctuation">(</span>treetext<span class="punctuation">)</span><span class="punctuation">)</span>  </span><br><span class="line"></span><br><span class="line">p1 <span class="operator">&lt;-</span> ggtree<span class="punctuation">(</span>tree<span class="punctuation">,</span>size<span class="operator">=</span><span class="number">0.8</span><span class="punctuation">)</span> <span class="comment">#画树，size指定线条粗细  </span></span><br><span class="line"><span class="operator">+</span> geom_tiplab<span class="punctuation">(</span>color<span class="operator">=</span><span class="string">&quot;black&quot;</span><span class="punctuation">,</span>size <span class="operator">=</span> <span class="number">4.5</span><span class="punctuation">,</span>hjust <span class="operator">=</span> <span class="operator">-</span><span class="number">0.1</span><span class="punctuation">,</span> align<span class="operator">=</span><span class="literal">TRUE</span><span class="punctuation">,</span> linesize<span class="operator">=</span><span class="number">0.7</span><span class="punctuation">)</span> <span class="comment">#添加tiplab-物种名  </span></span><br><span class="line"><span class="operator">+</span> geom_nodepoint<span class="punctuation">(</span>color<span class="operator">=</span><span class="string">&quot;#DCDCDC&quot;</span><span class="punctuation">,</span> size<span class="operator">=</span><span class="number">6</span><span class="punctuation">,</span> alpha<span class="operator">=</span><span class="number">0.9</span><span class="punctuation">)</span> <span class="comment">#节点处添加圆点，指定颜色灰色和尺寸6  </span></span><br><span class="line"><span class="operator">+</span> geom_nodelab<span class="punctuation">(</span>aes<span class="punctuation">(</span>label<span class="operator">=</span>C<span class="punctuation">)</span><span class="punctuation">,</span> size<span class="operator">=</span><span class="number">3.5</span><span class="punctuation">,</span> hjust <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span> <span class="comment">#在注释了标签C的节点处添加C的值，这里的标签C用于注释节点序号  </span></span><br><span class="line"><span class="operator">+</span> geom_label2<span class="punctuation">(</span>aes<span class="punctuation">(</span>x<span class="operator">=</span><span class="number">0.79</span><span class="punctuation">,</span>label<span class="operator">=</span>D<span class="punctuation">)</span><span class="punctuation">,</span>color<span class="operator">=</span><span class="string">&quot;black&quot;</span><span class="punctuation">,</span>vjust<span class="operator">=</span><span class="operator">-</span><span class="number">0.2</span><span class="punctuation">,</span>fill<span class="operator">=</span><span class="string">&quot;lightgreen&quot;</span><span class="punctuation">,</span>alpha<span class="operator">=</span><span class="number">0.6</span><span class="punctuation">)</span> <span class="comment"># 在注释了D的位置添加D的值，这里的标签D用于注释收缩基因的数量，x的值用于指定添加位置。  </span></span><br><span class="line"><span class="operator">+</span> geom_label2<span class="punctuation">(</span>aes<span class="punctuation">(</span>x<span class="operator">=</span><span class="number">0.73</span><span class="punctuation">,</span>label<span class="operator">=</span>I<span class="punctuation">)</span><span class="punctuation">,</span>color<span class="operator">=</span><span class="string">&quot;black&quot;</span><span class="punctuation">,</span>vjust<span class="operator">=</span><span class="operator">-</span><span class="number">0.2</span><span class="punctuation">,</span>fill<span class="operator">=</span><span class="string">&quot;pink&quot;</span><span class="punctuation">,</span>alpha<span class="operator">=</span><span class="number">0.6</span><span class="punctuation">)</span> <span class="comment"># 在注释了I的位置添加I的值，这里的标签I用于注释扩张基因的数量，x的值用于指定添加位置。  </span></span><br><span class="line"><span class="operator">+</span> xlim<span class="punctuation">(</span><span class="literal">NA</span><span class="punctuation">,</span><span class="number">1.1</span><span class="punctuation">)</span> <span class="comment"># 如果物种名或者其他标签超出显示范围，用xlim增大x轴显示。  </span></span><br><span class="line"></span><br><span class="line">p2<span class="operator">&lt;-</span> ggtree<span class="operator">::</span>rotate<span class="punctuation">(</span>p1<span class="punctuation">,</span><span class="number">13</span><span class="punctuation">)</span> <span class="comment">#旋转节点13的上下分支clade  </span></span><br><span class="line">p2<span class="operator">&lt;-</span> p1 <span class="operator">%&gt;%</span> rotate<span class="punctuation">(</span>node<span class="operator">=</span><span class="number">14</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span> rotate<span class="punctuation">(</span>node<span class="operator">=</span><span class="number">16</span><span class="punctuation">)</span> <span class="comment"># 旋转节点14和节点16  </span></span><br><span class="line"></span><br><span class="line">p2<span class="operator">+</span>geom_strip<span class="punctuation">(</span><span class="number">10</span><span class="punctuation">,</span><span class="number">10</span><span class="punctuation">,</span>label<span class="operator">=</span><span class="string">&quot;Vitales&quot;</span><span class="punctuation">,</span>offset <span class="operator">=</span> <span class="number">0.14</span><span class="punctuation">,</span> offset.text <span class="operator">=</span><span class="number">0.01</span><span class="punctuation">,</span>color <span class="operator">=</span> <span class="string">&quot;grey31&quot;</span><span class="punctuation">,</span>barsize <span class="operator">=</span> <span class="number">1.5</span><span class="punctuation">,</span>fontsize <span class="operator">=</span> <span class="number">5</span><span class="punctuation">)</span><span class="operator">+</span>geom_strip<span class="punctuation">(</span><span class="number">3</span><span class="punctuation">,</span><span class="number">7</span><span class="punctuation">,</span>label<span class="operator">=</span><span class="string">&quot;Fabids&quot;</span><span class="punctuation">,</span>offset <span class="operator">=</span> <span class="number">0.14</span><span class="punctuation">,</span> offset.text <span class="operator">=</span><span class="number">0.01</span><span class="punctuation">,</span>color <span class="operator">=</span> <span class="string">&quot;grey31&quot;</span><span class="punctuation">,</span>barsize <span class="operator">=</span> <span class="number">1.5</span><span class="punctuation">,</span>fontsize <span class="operator">=</span> <span class="number">5</span><span class="punctuation">)</span><span class="operator">+</span>geom_strip<span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span><span class="number">4</span><span class="punctuation">,</span>label<span class="operator">=</span><span class="string">&quot;Malvids&quot;</span><span class="punctuation">,</span>offset <span class="operator">=</span> <span class="number">0.14</span><span class="punctuation">,</span> offset.text <span class="operator">=</span><span class="number">0.01</span><span class="punctuation">,</span>color <span class="operator">=</span> <span class="string">&quot;grey31&quot;</span><span class="punctuation">,</span>barsize <span class="operator">=</span> <span class="number">1.5</span><span class="punctuation">,</span>fontsize <span class="operator">=</span> <span class="number">5</span><span class="punctuation">)</span> <span class="comment"># 给图加上分支clade的条带和文字注释</span></span><br></pre></td></tr></table></figure>

<h1 id="3-reference"><a href="#3-reference" class="headerlink" title="3. reference"></a>3. reference</h1><ol>
<li>ggtree paper：<a target="_blank" rel="noopener" href="https://besjournals.onlinelibrary.wiley.com/doi/full/10.1111/2041-210X.12628">https://besjournals.onlinelibrary.wiley.com/doi/full/10.1111/2041-210X.12628</a></li>
<li>book_visualization of phylogenetic trees](<a target="_blank" rel="noopener" href="https://yulab-smu.top/treedata-book/index.html">https://yulab-smu.top/treedata-book/index.html</a></li>
<li>ggtree tutorial：<a target="_blank" rel="noopener" href="https://guangchuangyu.github.io/ggtree-book/chapter-ggtree.html">https://guangchuangyu.github.io/ggtree-book/chapter-ggtree.html</a></li>
<li>treeio tutorial：<a target="_blank" rel="noopener" href="https://guangchuangyu.github.io/ggtree-book/chapter-treeio.html">https://guangchuangyu.github.io/ggtree-book/chapter-treeio.html</a></li>
<li>facet_plot：<a target="_blank" rel="noopener" href="https://guangchuangyu.github.io/2016/10/facet_plot-a-general-solution-to-associate-data-with-phylogenetic-tree/">https://guangchuangyu.github.io/2016/10/facet_plot-a-general-solution-to-associate-data-with-phylogenetic-tree/</a></li>
<li>不同树的绘制：<a target="_blank" rel="noopener" href="https://www.codenong.com/js9fda2b82cedb/">https://www.codenong.com/js9fda2b82cedb/</a></li>
</ol>
<hr>
<ul>
<li>欢迎关注微信公众号：<strong>生信技工</strong></li>
<li>公众号主要分享生信分析、生信软件、基因组学、转录组学、植物进化、生物学概念等相关内容，包括生物信息学工具的基本原理、操作步骤和学习心得。</li>
</ul>
<img src="https://github.com/yanzhongsino/yanzhongsino.github.io/blob/hexo/source/wechat/Wechat_public_qrcode.jpg?raw=true" width=50% title="wechat_public_QRcode.png" align=center/>
    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/tutorial/" rel="tag"># tutorial</a>
              <a href="/tags/biosoft/" rel="tag"># biosoft</a>
              <a href="/tags/phylogeny/" rel="tag"># phylogeny</a>
              <a href="/tags/evolutionary-tree/" rel="tag"># evolutionary tree</a>
              <a href="/tags/R/" rel="tag"># R</a>
              <a href="/tags/itol/" rel="tag"># itol</a>
              <a href="/tags/treeio/" rel="tag"># treeio</a>
              <a href="/tags/ggtree/" rel="tag"># ggtree</a>
              <a href="/tags/facet-plot/" rel="tag"># facet_plot</a>
              <a href="/tags/ggstance/" rel="tag"># ggstance</a>
              <a href="/tags/phylogenetic-reticulum/" rel="tag"># phylogenetic reticulum</a>
              <a href="/tags/geom-taxalink/" rel="tag"># geom_taxalink</a>
              <a href="/tags/multiPhylo/" rel="tag"># multiPhylo</a>
              <a href="/tags/ggdensitree/" rel="tag"># ggdensitree</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/01/16/linux_command.connector/" rel="prev" title="Linux的常用命令连接符（command connector）">
      <i class="fa fa-chevron-left"></i> Linux的常用命令连接符（command connector）
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/03/20/bioinfo_geneflow_TreeMix/" rel="next" title="系统发育网络推断 —— TreeMix">
      系统发育网络推断 —— TreeMix <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    
  <div class="comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
    </div>
  </div>
  

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#1-%E8%BF%9B%E5%8C%96%E6%A0%91"><span class="nav-text">1. 进化树</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-%E8%BF%9B%E5%8C%96%E6%A0%91%E7%9A%84%E7%BB%98%E5%88%B6"><span class="nav-text">2. 进化树的绘制</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#2-1-%E5%9C%A8%E7%BA%BF%E7%BB%98%E5%88%B6%E8%BF%9B%E5%8C%96%E6%A0%91"><span class="nav-text">2.1. 在线绘制进化树</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-2-R%E5%8C%85ggtree%E3%80%90%E6%8E%A8%E8%8D%90%E3%80%91"><span class="nav-text">2.2. R包ggtree【推荐】</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-1-%E6%A0%91%E6%96%87%E4%BB%B6%E7%9A%84%E5%AF%BC%E5%85%A5"><span class="nav-text">2.2.1. 树文件的导入</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-1-1-treeio%E5%AF%BC%E5%85%A5%E6%A0%91"><span class="nav-text">2.2.1.1. treeio导入树</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-2-ggtree%E7%94%BB%E6%A0%91"><span class="nav-text">2.2.2. ggtree画树</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-2-1-%E5%9F%BA%E7%A1%80%E7%94%BB%E6%A0%91"><span class="nav-text">2.2.2.1. 基础画树</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-2-2-%E5%9F%BA%E7%A1%80%E6%B3%A8%E9%87%8A"><span class="nav-text">2.2.2.2. 基础注释</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-2-3-%E6%94%B9%E5%8F%98%E6%A0%91%E7%9A%84%E7%BB%93%E6%9E%84"><span class="nav-text">2.2.2.3. 改变树的结构</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-2-4-%E5%8F%AF%E8%A7%86%E5%8C%96%E6%95%B0%E6%8D%AE%E5%B9%B6%E4%B8%8E%E7%B3%BB%E7%BB%9F%E5%8F%91%E8%82%B2%E6%A0%91%E5%85%B3%E8%81%94-%E2%80%94%E2%80%94-facet-plot"><span class="nav-text">2.2.2.4. 可视化数据并与系统发育树关联 —— facet_plot</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-2-5-%E6%97%B6%E5%BA%8F%E6%A0%91-chronogram"><span class="nav-text">2.2.2.5. 时序树(chronogram)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-2-6-%E7%B3%BB%E7%BB%9F%E5%8F%91%E8%82%B2%E7%BD%91-phylogenetic-reticulum-%E2%80%94%E2%80%94-geom-taxalink"><span class="nav-text">2.2.2.6. 系统发育网(phylogenetic reticulum) —— geom_taxalink</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-2-7-%E5%A4%9A%E6%A3%B5%E5%9B%BE%E5%85%B1%E5%90%8C%E5%B1%95%E7%A4%BA"><span class="nav-text">2.2.2.7. 多棵图共同展示</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-2-8-%E4%B8%80%E4%B8%AA%E7%94%9F%E6%88%90%E6%A0%91%E7%9A%84%E4%BE%8B%E5%AD%90"><span class="nav-text">2.2.2.8. 一个生成树的例子</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3-reference"><span class="nav-text">3. reference</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">南方枝叶</p>
  <div class="site-description" itemprop="description">学习生物信息学的笔记本</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">89</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">46</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">277</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/yanzhongsino" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;yanzhongsino" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:yan.zhong.sino@gmail.com" title="E-Mail → mailto:yan.zhong.sino@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2018 – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="snowflake-o"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">南方枝叶</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="Symbols count total">482k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="Reading time total">7:18</span>
</div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

  

<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://yanzhongsino.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script>
<script>
  var disqus_config = function() {
    this.page.url = "http://example.com/2022/01/24/bioinfo_evolutionary.tree_ggtree/";
    this.page.identifier = "2022/01/24/bioinfo_evolutionary.tree_ggtree/";
    this.page.title = "绘制进化树 —— R包treeio+ggtree";
    };
  NexT.utils.loadComments(document.querySelector('#disqus_thread'), () => {
    if (window.DISQUS) {
      DISQUS.reset({
        reload: true,
        config: disqus_config
      });
    } else {
      var d = document, s = d.createElement('script');
      s.src = 'https://yanzhongsino.disqus.com/embed.js';
      s.setAttribute('data-timestamp', '' + +new Date());
      (d.head || d.body).appendChild(s);
    }
  });
</script>

</body>
</html>
